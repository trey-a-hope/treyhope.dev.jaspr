[{"title":"Coffee & Codeâ€Šâ€”â€ŠWorking With Nakama, The Only Gaming Backend You Need","slug":"coffee-code-working-with-nakama","date":"2024-05-23T00:00:00.000","author":"Trey Hope","tags":["nakama","coffee","flutter","game-development","gift-grab"],"excerpt":"During my previous usage of Nakama, I didnâ€™t fully utilize sessions for proper user authentication.","content":"![Preview image](https://miro.medium.com/v2/resize:fit:700/1*9sHLR6ZeA6kVSo3ATCQDWQ.jpeg)\n\n# Coffee & Codeâ€Šâ€”â€ŠWorking With Nakama, The Only Gaming Backend You Need â˜•ðŸ’»\n\n## During my previous usage of Nakama, I didn't fully utilize sessions for proper user authentication.\n\n| [![Trey Hope](https://miro.medium.com/v2/resize:fill:64:64/1*vAqjfeI49DX9ekel4o6gIw.jpeg \"Trey Hope\")](https://medium.com/@treyhope) | [**Trey Hope**](https://medium.com/@treyhope) | ðŸ•“ 3 min read | ðŸ“… May 23, 2024 |  \n|:--|:--|:--|:--|\n\nIn one of my most recent applications, known as Gift Grab, the concept of a user's \"session\" was implemented in a rather simplistic way.\n\n![Nakama Website](https://miro.medium.com/v2/resize:fit:700/1*qIfEFVhRTBMRIDcsOmKOtQ.gif \"Nakama Website\")<br/>*Nakama Website*\n\nIt was solely based on whether the user had signed into the app or not.\n\n![Nakama Sessions](https://miro.medium.com/v2/resize:fit:700/1*xbunxmCAmme08aC1jxIQzw.gif \"Nakama Sessions\")<br/>*Nakama Sessions*\n\nUnfortunately, this approach did not take into account the exact moment of sign-in or the duration of the user's interaction with the app.\n\n![Flutter UI with Sessions](https://miro.medium.com/v2/resize:fit:700/1*OaZSBSoKhhvfJsDJL2wf5Q.gif \"Flutter UI with Sessions\")<br/>*Flutter UI with Sessions*\n\nHowever, as I delved deeper into the comprehensive and detailed documentation provided by Nakama, a realization dawned on me.\n\n```dart\nimport 'dart:async';\nimport 'package:flutter/material.dart';\nimport 'package:flutter_riverpod/flutter_riverpod.dart';\nimport 'package:nakama/nakama.dart';\nimport 'package:nakama_ui/data/services/hive_session_service.dart';\n\n/// Provider used to check if the user is authenticated.\nclass NakamaAuthProvider extends AsyncNotifier<bool> {\n  /// HiveSessionService instance.\n  final _hiveSessionService = HiveSessionService();\n\n  @override\n  FutureOr<bool> build() async {\n    // Initialize Nakama client.\n    getNakamaClient(\n      host: '127.0.0.1',\n      ssl: false,\n      serverKey: 'defaultkey',\n      httpPort: 7350,\n    );\n\n    // Fetch the current session.\n    final session = await _hiveSessionService.sessionActive();\n\n    return session != null;\n  }\n}\n```\n\nIt became clear that I should be leveraging the concept of sessions to manage user interactions with the app in a much more effective and efficient way.\n\n![Nakama Leaderboards](https://miro.medium.com/v2/resize:fit:700/1*rKNEnfZl3q7P4FIFhq42-w.gif \"Nakama Leaderboards\")<br/>*Nakama Leaderboards*\n\nTo provide a bit of context, broadly speaking, a \"session\" refers to a distinct period during which a user is authenticated with a particular system.\n\n![None](https://miro.medium.com/v2/resize:fit:700/1*xDdWr1yeJHsiK_imQ_FHDQ.gif)\n\nIt represents an established connection between the user and the system, facilitating a secure and personalized interaction.\n\n```java\nimport 'dart:async';\nimport 'package:flutter/material.dart';\nimport 'package:flutter_riverpod/flutter_riverpod.dart';\nimport 'package:nakama/nakama.dart';\nimport 'package:nakama_ui/data/services/hive_session_service.dart';\n\n/// Provider that handles listing/creating leaderboard records.\nclass NakamaLeaderboardProvider extends AsyncNotifier<List<LeaderboardRecord>> {\n  /// Leaderboard name.\n  static const _leaderboardName = 'weekly_leaderboard';\n\n  /// HiveSessionService instance.\n  final _hiveSessionService = HiveSessionService();\n\n  @override\n  FutureOr<List<LeaderboardRecord>> build() async {\n    // Fetch the current session.\n    final session = await _hiveSessionService.sessionActive();\n\n    // If session is null, return empty list.\n    if (session == null) {\n      return [];\n    }\n\n    // Get leaderboard records.\n    final leaderboardRecordList =\n        await getNakamaClient().listLeaderboardRecords(\n      session: session,\n      leaderboardName: _leaderboardName,\n    );\n\n    // Return leaderboard records from list.\n    return leaderboardRecordList.records;\n  }\n}\n```\n\nIn the context of Nakama, the session takes on an even more critical role. It is represented as a client-side object that authenticates the client when they are accessing server functions.\n\n![None](https://miro.medium.com/v2/resize:fit:700/1*gRzRDHeSPoa-FQac6ZMpqw.gif)\n\nThis implementation provides a significantly more secure way for users to interact with server functions, thereby improving overall app security.\n\n```php\n// Decode the session token.\nfinal res = JwtDecoder.decode(session.token);\n\n// Return session data from decoded token.\nreturn SessionData(\n  uid: res['uid'],\n  username: res['usn'],\n  email: res['vrs']['email'],\n  expiresAt: DateTime.fromMillisecondsSinceEpoch(res['exp'] * 1000),\n);\n```\n\nThere is more to come on this topic, so stay tuned for more insights and revelations in the near future.\n\n[#nakama](https://medium.com/tag/nakama \"Nakama\") [#game-development](https://medium.com/tag/game-development \"Game Development\") [#leaderboard](https://medium.com/tag/leaderboard \"Leaderboard\") [#coding](https://medium.com/tag/coding \"Coding\") [#coffee-culture](https://medium.com/tag/coffee-culture \"Coffee Culture\")"},{"title":"Coffee & Code - Creating Custom User Flows for Development with Miro","slug":"coffee-code-development-with-miro","date":"2024-04-27T00:00:00.000","author":"Trey Hope","tags":["flutter","miro","userflows"],"excerpt":"I decided to try out Miro because of itâ€™s simplicity and recommendation from other developers.","content":"# Coffee & Code - Creating Custom User Flows for Development with Miro\n\n**I decided to try out Miro because of itâ€™s simplicity and recommendation from other developers.**\n\n![1_nUheo1oNL-JDeI5CFJKWbA.jpg](/blogs/2024-04-27-coffee-code-development-with-miro/1_nUheo1oNL-JDeI5CFJKWbA.jpg)\n\n> Cappuccino fromÂ [**CafÃ©s De Origin**](https://cafesdeorigen.net/)Â in El Poblado, MedellÃ­n\n> \n\nWhen it comes to building applications, I used to jump right into development.\n\nMinimum understanding, with a lack of structured resources was always a go to for me.\n\nHowever, without having a strict process to follow, I always found myself asking more questions than I should while in the middle of development.\n\n![1_AFzsEc4-VRCDK6OU3NljVQ.gif](/blogs/2024-04-27-coffee-code-development-with-miro/1_AFzsEc4-VRCDK6OU3NljVQ.gif)\n\n> Miro website.\n> \n\nMaybe because of my eagerness to start coding, (Iâ€™m pretty sure thatâ€™s it), but I skipped one of the most important steps in development; creating user flows.\n\nA user flow is a user experience (UX) concept that explores and records the actions a typical user must take to complete a specific task.\n\nWith this understanding, it makes the development smoother as you now how a solid reference on what the experience should be from the clientâ€™s perspective.\n\n![1_bFxptW--kGEt4GnMA03hvw.gif](/blogs/2024-04-27-coffee-code-development-with-miro/1_bFxptW--kGEt4GnMA03hvw.gif)\n\n> My example user flow for the project.\n> \n\nThere are several softwares available to create user flows, includingÂ [**ClickUp**](https://clickup.com/)Â andÂ [**Figma**](https://www.figma.com/), but I decided to try outÂ [**Miro**](https://miro.com/)Â because of itâ€™s simplicity and recommendation from other developers.\n\nI am preparing to work on a web app for a local coffee shop and felt it was the opportune time to develop this app the right way.\n\nThis is my simple user flow as of now, with navigation between pages and actions when clicking buttons.\n\n![1_q7kz1cC_AhpBOuhJogplvw.gif](/blogs/2024-04-27-coffee-code-development-with-miro/1_q7kz1cC_AhpBOuhJogplvw.gif)\n\n> [**Article**](https://medium.com/@flutterwtf/mobile-app-design-process-91de3fa9cf6c)Â from What The Flutter about a strong mobile app design process.\n> \n\nMore details coming soon as I progress on this new project."},{"title":"Coffee & Code - Coffee & Code â€” Sorting Firestore Data & Displaying Toast Messages in Flutter","slug":"coffee-code-sorting-firestore-data","date":"2024-04-21T00:00:00.000","author":"Trey Hope","tags":["firestore","toasts","flutter","riverpod","sorting"],"excerpt":"Using Riverpod to handle search queries is more helpful than I could have ever imagined.","content":"![Preview image](/blogs/2024-04-21-coffee-code-sorting-firestore-data/1_YSmctWmz6H_DQRDafyqW5A.jpg)\n\nBack on the QuoteKeeper app per usual.\n\n![None](/blogs/2024-04-21-coffee-code-sorting-firestore-data/1_qHzMtGyw5RzZ7p3VNjQU8w.jpg)\n\nSome features I've been working on this sprint is the ability to sort the books and display toasts messages.\n\n![Video Demo](/blogs/2024-04-21-coffee-code-sorting-firestore-data/1_tK89gLMm0D5igCzhkezS8g.gif \"Video Demo\")<br/>*Video Demo*\n\nFor sorting, I updated the method for fetching books to accept a string query param and a boolean isDescending param.\n\n```dart\nimport 'dart:async';\nimport 'package:cloud_firestore/cloud_firestore.dart';\nimport 'package:quote_keeper/data/services/book_service.dart';\nimport 'package:quote_keeper/domain/models/book_model.dart';\nimport 'package:quote_keeper/utils/config/providers.dart';\n\n/// Fetch the next list of books using \nvoid getNextBooks() async {\n  try {\n    state = const AsyncLoading();\n\n    // Order by term, i.e. name, author, title, etc.\n    final orderBy = ref.read(Providers.bookSearchTermProvider).query;\n\n    // Is the list descending or not.\n    final descending = ref.read(Providers.bookSearchIsDescendingProvider);\n\n    // Return the quotes for this user.    \n    final uid = ref.read(Providers.authAsyncProvider.notifier).getUid();\n\n    final querySnapshot = await _bookService.getBooks(\n      orderBy: orderBy,\n      descending: descending,\n      uid: uid,\n\n      // Previous firestore document used for pagination.\n      lastDocument: _lastDocument,\n\n      // Number of results to fetch with each query.=\n      limit: 10,\n    );\n\n    _lastDocument = querySnapshot.docs.last;\n\n    List<BookModel> books = _convertQuerySnapshotToBooks(querySnapshot);\n\n    state = AsyncData([...state.value!, ...books]);\n } catch (e) {}\n```\n\nThe BookSearchIsDescendingNotifier returns true/false if the list should be descending.\n\n```dart\nimport 'package:flutter_riverpod/flutter_riverpod.dart';\n\n/// Holds the value of whether the search results are descending or not.\nclass BookSearchIsDescendingNotifier extends AutoDisposeNotifier<bool> {\n  \n  /// Default isDescending to true.\n  @override\n  bool build() => true;\n\n  /// Update to the inverse of its current value.\n  void toggle() => state = !state;\n}\n```\n\nThe BookSearchTermNotifier returns the current BookSearchTerm, (name, author, created date, or modified date).\n\n```dart\nimport 'package:flutter_riverpod/flutter_riverpod.dart';\n\n/// Options for sorting a users quotes.\nenum BookSearchTerm {\n  title('Title', 'title'),\n  created('Created', 'created'),\n  modified('Modified', 'modified'),\n  author('Author', 'author');\n  \n  const BookSearchTerm(this.label, this.query);\n\n  final String label;\n  final String query;\n}\n\n/// Holds the current query for searching quotes.\nclass BookSearchTermNotifier extends AutoDisposeNotifier<BookSearchTerm> {\n  // Default the book search to sort by created value.\n  @override\n  BookSearchTerm build() => BookSearchTerm.created;\n\n  // Update the book search term enum value.\n  void updateTerm(BookSearchTerm term) => state = term;\n}\n```\n\nFor displaying modal toasts, which are temporary messages displayed in the UI, I incorporated the [Toastification](https://pub.dev/packages/toastification) flutter package.\n\n![Updating username.](/blogs/2024-04-21-coffee-code-sorting-firestore-data/1_6mQtovDuGqpKUBVGr5sOcQ.gif \"Updating username.\")<br/>*Updating username.*\n\nIt is a very lightweight and flexible package for making use of toast messages.\n\n```dart\nimport 'package:flutter/material.dart';\nimport 'package:quote_keeper/utils/constants/toast_type.dart';\nimport 'package:toastification/toastification.dart';\n\nclass ModalService {\n  /// Displays a toast message.\n  /// Takes in a required context and message.\n  /// The toastType modifies ui icons and colors.\n  /// The alignment determines position on screen.\n  static void showToast({\n    required BuildContext context,\n    required String message,\n    ToastType toastType = ToastType.success,\n    Alignment alignment = Alignment.bottomCenter,\n  }) =>\n      toastification.show(\n        context: context,\n        style: ToastificationStyle.minimal,\n        autoCloseDuration: const Duration(seconds: 5),\n        title: Text(message),\n        alignment: alignment,\n        animationDuration: const Duration(milliseconds: 300),\n        icon: toastType.icon,\n        primaryColor: toastType.color,\n        backgroundColor: toastType.color.shade50,\n        foregroundColor: Colors.black,\n        padding: const EdgeInsets.symmetric(horizontal: 12, vertical: 16),\n        margin: const EdgeInsets.symmetric(horizontal: 12, vertical: 8),\n        borderRadius: BorderRadius.circular(12),\n        showProgressBar: false,\n        closeButtonShowType: CloseButtonShowType.onHover,\n        closeOnClick: true,\n      );\n}\nimport 'package:flutter/material.dart';\n\nenum ToastType {\n  success(Colors.blue, Icon(Icons.check)),\n  failure(Colors.red, Icon(Icons.cancel));\n\n  const ToastType(\n    this.color,\n    this.icon,\n  );\n\n  final MaterialColor color;\n  final Icon icon;\n}\n```\n\nVersion 1.7.0 now available for [iOS](https://apps.apple.com/us/app/quote-keeper-save-book-quotes/id6471941046) and [Android](https://play.google.com/store/apps/details?id=com.io.book_quotes&hl=en_US&gl=US).\n\nThat's all for right now, what are you working on? Leave a comment, I'd love to hear about it.\n\n[#flutter](https://medium.com/tag/flutter \"Flutter\") [#firebase](https://medium.com/tag/firebase \"Firebase\") [#firestore](https://medium.com/tag/firestore \"Firestore\") [#galaxy-z-fold-3](https://medium.com/tag/galaxy-z-fold-3 \"Galaxy Z Fold 3\") [#coffee-culture](https://medium.com/tag/coffee-culture \"Coffee Culture\")"}]